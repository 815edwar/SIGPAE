{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
	<title>SIGPAE</title>
		<link rel="stylesheet" type="text/css" href="{% static 'bootstrap/css/bootstrap.min.css'%}">
		<link rel="stylesheet" type="text/css" href="{% static 'css/base.css'%}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/transcriptor.css' %}">
</head>
<body>
    <div class="row">
        
    <div id="panel_config" class="col-lg-5 col-md-5 col-xs-5">
        <button id="config_2" class="boton">Configuracion 2</button>
        <button id="volver" class="boton" >Configuracion 1</button>
        <a href="{{request.META.HTTP_REFERER}}"><button id="back" class="boton" >Volver</button></a>
    </div>
    <div class="col-lg-7 col-md-7 col-xs-7"></div>
    </div>

	<div class="row">
		<div id="documento" class="col-lg-5 col-md-5 col-xs-5">
            <div id="pdf" class="pdfobject-container"></div>
		</div>


            <div  class="col-lg-7 col-md-7 col-xs-7 " id="formulario">
                <form id="form" enctype="multipart/form-data" action="" method="post" accept-charset="utf-8" class="form-group" role="form" novalidate>
                    {% for field in formulario %}
                        <div class="control-group" id="{{field.name}}-state">
                            <div class="input-group {{field.name}}">
                                <span class="input-group-addon tags-unete can_hide" id="basic-addon1"><b>{{ field.label }}:</b></span>{{ field }}
                            </div>
                            <span class="error" id="{{ field.name }}-icon"></span>
                            <span class='error' id='{{field.name}}-error' aria-live="polite"></span>
                            {{ field.errors }}
                        </div>

                    {% endfor %}
                    <div class="control-group" >
                            <div class="input-group">
                                <span class="input-group-addon tags-unete can_hide" id="basic-addon1"><b>Encargado:</b></span>
                                {% if encargado != None%}
                                <input aria-describedby="basic-addon1" class="form-control can_hide " value="{{encargado}}" id="encargado" required="False" type="text" readonly>
                                {% else %}
                                <input aria-describedby="basic-addon1" class="form-control can_hide " id="encargado" value="" required="False" type="text" readonly>
                                {% endif %}
                            </div>
                    </div>
                    <input type="checkbox" class="encargado" id="Departamento" name="check" value="Departamento"> Departamento
                    <input type="checkbox" class="encargado" id="Coordinacion" value="Coordinacion" name="check" value="Coordinacion"> Coordinación
                    
                    <select id="departamentos" name="departamentos" class="dinamica">

                    </select>
                    <select id="decanatos" class="dinamica">
                        
                    </select>

                    <select id="coordinaciones" name="coordinacion" class="dinamica">
                        
                    </select> 
                    <input type="hidden" name="pdf_id" value="{{ pdf.id }}">
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                </form>
                <button class="botonTrans1" id="button-signup">Guardar Cambios</button> 


                <!-- Modal -->
                <div id="myModal" class="modal fade" role="dialog">
                  <div class="modal-dialog">

                    <!-- Modal content-->
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Se extrajo este código</h4>
                      </div>
                      <div class="modal-body">
                        <input id="codigo" type="text" name="codigo" value="{{pdf.codigo}}">
                        {% if prefijo %}
                            <h3>Se logró asociar el código al siguiente departamento:</h3> 
                            <input id="asociacion" type="text" name="" value="{{prefijo.asociacion}}">
                        {% else %}
                            <h3>No se pudo asociar el código a ningún departamento.</h3>
                        {% endif %}
                      </div>
                      <div class="modal-footer"> 
                        <button id="aceptar" type="button" class="btn btn-default" data-dismiss="modal">Aceptar</button>
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>

                      </div>
                    </div>

                  </div>
                </div>

            </div>


    </div>
{% block custom_script %}
    <script type="text/javascript" src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'bootstrap/js/bootstrap.min.js'%}"></script>

    <script type="text/javascript" src="{% static 'js/pdfobject.js' %}"></script>

    <script>
        $(document).ready(function() {

            $('#myModal').modal('toggle');
            $('#myModal').modal('show');
            var asociacion = $('#asociacion').val();
            $('#aceptar').click(function(){
              $('#encargado').val(asociacion);
            });


            $(".dinamica").hide();
            $("#drag").css('display','none');
            PDFObject.embed("{{ pdf.pdf.url }}" , "#pdf");
           
            /* Estos son configuraciones para el display
            de los documentos, solo falta agregar los botones
            es
            $('#config_1').click(function() {
                $("#formulario").after($("#documento"));
            });
            
            $('#config_3').click(function() {
                $("#documento").css('display','none');
                $("#div1").css('display','block');
            });
            */
            $('#config_2').click(function() {
                $(".can_hide").hide();
            });

            $('#volver').click(function() {
                var $documento = $("#documento");
                $("#div1").css('display','none');
                $documento.css('display','block');
                $("#formulario").before($documento);
                $(".can_hide").show();



            });            
         });

        $('#button-signup').click(function(){
            event.preventDefault();
            var inputs = $('.horas');
            var total = 0;
            for(var i = 0; i < inputs.length; i++){
                total = total + parseInt($(inputs[i]).val());
            }
            if (parseInt(total) > 40){
                
                alert("El número de horas semanales no puede superar las 40 horas.");
                
            }
            else{
                $('#form').submit();
            }

        });

        $('input').on('change', function() {
            $('input').not(this).prop('checked', false);  
        });
        $('.encargado').click(function(){
            if ($(this).attr('id') == 'Departamento'){
                var $departamentos = $('#departamentos');
                $departamentos.show();
                $('#decanatos').hide();
                $('#coordinaciones').hide();
                
                $departamentos.find('option').remove().end();

                $.ajax({
                    url: '{% url "encargado" %}',
                    data: {
                        'encargado' : $(this).attr('id')
                    },
                    dataType: 'json',
                    success: function(data){
                            var tamano = data.departamento.length;
                            for (var i = 0; i < tamano; i++) {
                                console.log(data.departamento[i].nombre);
                                $('#departamentos').append($('<option>', {
                                    value: data.departamento[i].nombre,
                                    text: data.departamento[i].nombre
                                }));
                                
                            }
                    }
                });
            }else{
                var $decanatos = $('#decanatos');
                $decanatos.show();
                $('#departamentos').hide();

                $decanatos.find('option').remove().end();
                $.ajax({
                    url: '{% url "encargado" %}',
                    data: {
                        'encargado' : $(this).attr('id')
                    },
                    dataType: 'json',
                    success: function(data){
                            var tamano = data.decanatos.length;
                            var $decanatos = $('#decanatos');
                            $decanatos.append($('<option>', {
                                value: '---',
                                text: '---'
                            }));
                            for (var i = 0; i < tamano; i++) {
                                console.log(data.decanatos[i].nombre);
                                $decanatos.append($('<option>', {
                                    value: data.decanatos[i].id,
                                    text: data.decanatos[i].nombre
                                }));
                                
                            }
                    }
                });
            }
        });
        
        $('#decanatos').change(function(){
            $('#coordinaciones').find('option').remove().end();
            console.log($(this).val());
            $.ajax({
                    url: '{% url "encargado" %}',
                    data: {
                        'decanato' : $(this).val()
                    },
                    dataType: 'json',
                    success: function(data){
                        var $coordinaciones = $('#coordinaciones');
                        $coordinaciones.show();
                        var tamano = data.coordinaciones.length;
                        for (var i = 0; i < tamano; i++) {
                            console.log(data.coordinaciones[i].nombre);
                            $coordinaciones.append($('<option>', {
                                value: data.coordinaciones[i].nombre,
                                text: data.coordinaciones[i].nombre
                            }));
                        }
                    }
                });
        });





    </script>
{% endblock %}
</body>
</html>
